<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/black.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css" />

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement("link");
      link.rel = "stylesheet";
      link.type = "text/css";
      link.href = window.location.search.match(/print-pdf/gi)
        ? "css/print/pdf.css"
        : "css/print/paper.css";
      document.getElementsByTagName("head")[0].appendChild(link);
    </script>
    <script>
      function closeAll(openDetails) {
        var details = document.getElementsByTagName("details");
        var len = details.length;
        for (var i = 0; i < len; i++) {
          if (details[i] != openDetails) {
            details[i].removeAttribute("open");
          }
        }
      }
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <!-- Chapter1 -->
          <section>
            <h1>Introduction</h1>
            <p>Simple alternative to J2EE since 2003</p>
            <p>Typical webapp based on Spring MVC</p>
            <table>
              <tr>
                <td style="background-color: green">presentation</td>
                <td style="background-color: darkred" rowspan="3">
                  domain objects <br />POJOs
                </td>
              </tr>
              <tr>
                <td style="background-color: blue">logic</td>
              </tr>
              <tr>
                <td style="background-color: darkgoldenrod">persistence</td>
              </tr>
            </table>
          </section>
          <section
            data-background-iframe="https://spring.io"
            data-background-interactive
          ></section>
          <section>
            <h2>Spring Framework Stacks</h2>
            <img width="500" data-src="screenshots/SpringFramework.png" />
          </section>
          <section data-markdown>
            <script type="text/template">
              - OpenSource application framework for Java
              - Frustration due to unnecessary complexity of 
              J2EE architectures (EJBs and application server)
              - Lightweight alternative to J2EE mananges POJOs as Spring Beans
              - Uses Inversion of Control (IoC) to connect and configure dependent Beans
              - Uses Aspect oriented Programming (AoP) for Cross-Cutting Concerns
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              - Spring can effectively organize your middle tier objects.
              - Spring can eliminate the proliferation of Singletons seen on many projects.
              - Spring eliminates the need to use a variety of custom properties file formats.
              - Spring facilitates good programming practice by reducing the cost of
              programming to interfaces, rather than classes, almost to zero.
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              - Spring is designed so that applications built with it depend on as few of its APIs
              as possible.
              - Applications built using Spring are very easy to test.
              - Spring helps you solve problems with the most lightweight possible infrastructure.
              - Spring provides a consistent, simple programming model in many areas,
              making it ideal architectural "glue."
            </script>
          </section>
        </section>
        <section>
          <!-- Chapter 2 -->
          <section data-markdown>
            <script type="text/template">
              ## Dependency Injection
              Hollywood-Prinzip: „Don't call us, we call you“
                - Klasse bekommt benötigte Komponenten von außen „injiziert“
                - Klasse muss nur wissen was sie braucht, nicht wie sie es bekommt
                - DI Container garantiert, dass Abhängigkeiten gesetzt werden
                - entkoppelt Klasse von der Laufzeitumgebung
            </script>
          </section>
          <section>
            <h2>DJ Methods</h2>
            <ul>
              <li class="fragment">Construktor Injection</li>
              <li class="fragment">Field / Setter Injection</li>
            </ul>
          </section>

        </section>

        <section>
          <!-- Chapter 3 -->
          <section data-markdown>
            <script type="text/template">
              ## Spring Boot
            </script>
          </section>
          <section
            data-background-iframe="https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started-system-requirements.html"
          ></section>
          <section data-markdown>
            <script type="text/template">
              ## RestController
              ```java
              @RestController
              class RootContoller {

                @RequestMapping("/")
                String home() {
                  "Hello World!"
                }

              }
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Exercise 1 Setup Spring Boot
              * 1.1 Simplest way to run a spring boot app with spring CLI
              * 1.2 Initialize Project
              * 1.3 Import project to STS
              * 1.4 Import project to VS-Code
              * 1.5 Build and run the project from CLI and IDE
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## [Exercise 1.1](exercises/ex-1.1/ex-1.1.md) Simplest way to run a spring boot app
              <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started-installing-spring-boot.html">Install Spring CLI</a>
              ```bash
              spring run exercises/ex-1.1/app.groovy
              ```

              [Samples](https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-cli/samples)

              ```bash
               spring run https://raw.githubusercontent.com/spring-projects/spring-boot/master/spring-boot-project/spring-boot-cli/samples/http.groovy
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## 1.2 Initialize Project:
              https://start.spring.io/
              <img width="600px" src="screenshots\SpringInitializr.png" alt="SpringInitializr">
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## 1.3 Import into STS:
              - File -> Import... -> Maven -> Existing Maven Projects
              <img width="600px" src="screenshots\mavenimport.png" alt="SpringInitializr">
              - Look at the pom.xml file
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### 1.4 Import project to VS-Code

              - create .vscode/extensions.json in your workspace
              - then install all the extensions

              ```
              {
                "recommendations": [
                  "redhat.java",
                  "vscjava.vscode-maven",
                  "vscjava.vscode-java-pack",
                  "vscjava.vscode-spring-boot-dashboard",
                  "pivotal.vscode-boot-dev-pack",
                  "pivotal.vscode-spring-boot",
                  "ecmel.vscode-spring-boot",
                  "vscjava.vscode-spring-initializr",
                  "gabrielbb.vscode-lombok"
              
                ],
                "unwantedRecommendations": []
              }
              
              ```

            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## 1.5 Build and run the project from CLI and IDE

              ```bash
              java -version
              mvn -v
              mvn dependency:tree
              mvn spring-boot:run
              mvn package
              java -jar target\api-0.0.1-SNAPSHOT.jar
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Offtopic:
              /profile endpoint supplied by spring-data-rest:
              https://github.com/spring-projects/spring-boot/issues/1718
              https://tools.ietf.org/html/rfc6906

              HATEOAS: Hypermedia As The Engine Of Application State
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### @SpringBootApplication Class

              ```
              package de.coolsafe.api;

              import org.springframework.boot.SpringApplication;
              import org.springframework.boot.autoconfigure.SpringBootApplication;

              // -> More annotations will end up here during development
              @SpringBootApplication
              public class ApiApplication {

                public static void main(String[] args) {
                  SpringApplication.run(ApiApplication.class, args);
                }

              }

              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### @SpringBootApplication features

              - @EnableAutoConfiguration: enable Spring Boot’s auto-configuration mechanism
              - @ComponentScan: enable @Component scan on the package where the application is located (see the best practices)
              - @Configuration: allow to register extra beans in the context or import additional configuration classes
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### AutoConfiguration

              "Auto-configuration Spring Boot auto-configuration attempts to
              automatically configure your Spring application based on the jar
              dependencies that you have added."

              E.G. Disable DataSourceAutoConfiguration
              ```java
              @EnableAutoConfiguration(exclude={DataSourceAutoConfiguration.class})
              ```
            </script>
            <aside class="notes">
              For example, if HSQLDB is on your classpath, and you have not
              manually configured any database connection beans, then Spring
              Boot auto-configures an in-memory database. You need to opt-in to
              auto-configuration by adding the @EnableAutoConfiguration or
              @SpringBootApplication annotations to one of your @Configuration
              classes.
            </aside>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Config without ComponentScan

              ```java
              @Configuration
              @EnableAutoConfiguration
              @Import({ MyConfig.class, MyAnotherConfig.class })
              public class Application {

                public static void main(String[] args) {
                    SpringApplication.run(Application.class, args);
                }

              }
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### @Project Structure
              <img height="500" data-src="screenshots/StructuringYourCode.png" />
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Spring Bean Types
              - @Component is a generic stereotype for any Spring-managed component
              - @Service annotates classes at the service layer
              - @Repository annotates classes at the persistence layer, which will act as a database repository
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### @ComponentScan & @Autowired
              > "You are free to use any of the standard Spring Framework techniques to define your beans and their injected dependencies.
              For simplicity, we often find that using @ComponentScan (to find your beans) and using @Autowired (to do constructor injection) works well."

              [Example](https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-spring-beans-and-dependency-injection.html)
            </script>
          </section>
        </section>

        <section>
          <!-- Chapter 4 -->
          <section data-markdown>
            <script type="text/template">
              # 4. REST and Postman
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## RestController
              ```java
              @RestController
              class RootContoller {

                @RequestMapping("/")
                String home() {
                  "Hello World!"
                }

              }
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### REST
              - Representational State Transfer (REST)
              - RESTful Web services (RWS)
              - Provide interoperability between computer systems on the Internet.
              - Stateless protocol
              - Standard operations (HTTP)
              - Other kinds of Web services, such as SOAP Web services, expose their own arbitrary sets of operations.
            </script>
            <aside class="notes">
              By stateless it means that the server does not store any state
              about the client session on the server side. The client session is
              stored on the client. The server is stateless means that every
              server can service any client at any time, there is no session
              affinity or sticky sessions
            </aside>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Goals of RESTful Web services
              * Fast performance - A stateless API is easy to cache.
              * Reliability - State is always known to the server, because client sends all necessary information with each request.
              * Scale APIs to millions of concurrent users because any server can handle any request.
              * Ability to grow by reusing components
              * Being stateless makes REST APIs less complex (no server-side state synchronization logic)
              * Components updatable without affecting the system as a whole, even while it is running.
            </script>
            <aside class="notes">
              A specific software can decide whether or not to cache the result
              of an HTTP request just by looking at that one request. There’s no
              nagging uncertainty that state from a previous request might
              affect the cacheability of this one. It improves the performance
              of applications.
            </aside>
          </section>
          <section
            data-background-iframe="https://en.wikipedia.org/wiki/Application_programming_interface#Web_APIs"
          >
            <div
              style="position: absolute; width: 80%;  bottom: 9999; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 20px; font-size: 20px; text-align: left;"
            >
              <h3>REST or RESTful is not a standard, but a WebAPI</h3>
              <ul>
                <li>Client-Server Architecture</li>
                <li>Stateless</li>
                <li>Cacheability</li>
                <li>Layered System</li>
                <li>Uniform Interface</li>
              </ul>
              <em
                ><a
                  href="https://en.wikipedia.org/wiki/Application_programming_interface#Web_APIs"
                  >https://en.wikipedia.org/wiki/Application_programming_interface#Web_APIs</a
                ></em
              >
            </div>
          </section>
          <section
            data-background-iframe="https://martinfowler.com/articles/richardsonMaturityModel.html"
          >
            <div
              style="position: absolute; width: 60%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 20px; font-size: 20px; text-align: left;"
            >
              <h3>REST Majurity Model by Martin Fowler</h3>
              <ol start="0">
                <li>SOAP</li>
                <li>Resources</li>
                <li>HTTP Verbs</li>
                <li>Hypermedia Controls</li>
              </ol>
              <em
                ><a
                  href="https://martinfowler.com/articles/richardsonMaturityModel.html"
                  >https://martinfowler.com/articles/richardsonMaturityModel.html</a
                ></em
              >
              <a href="https://tools.ietf.org/html/rfc7231">
                Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a
              >
            </div>
            <aside class="notes">
              <p>
                Level 1 tackles the question of handling complexity by using
                divide and conquer, breaking a large service endpoint down into
                multiple resources.
              </p>
              <p>
                Level 2 introduces a standard set of verbs so that we handle
                similar situations in the same way, removing unnecessary
                variation.
              </p>
              <p>
                Level 3 introduces discoverability, providing a way of making a
                protocol more self-documenting.
              </p>
            </aside>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## @Mapping Types

              - @GetMapping
              - @PostMapping
              - @PutMapping
              - @DeleteMapping

              ```java
              @RequestMapping(value="/api/tasks{id}", method=RequestMethod.PATCH)
              public @ResponseBody void saveTask(
                  @PathVariable Long id, @RequestBody Map<Object, Object> fields) {
              ```

              <a href="https://blog.fullstacktraining.com/restful-api-design-post-vs-put-vs-patch/"> Good Article about Post, Patch, Put</a>
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Spring-Data-Rest

              "The best from REST and data."
              https://docs.spring.io/spring-data/rest/docs/current/reference/html/#getting-started.boot

              ```
              @RepositoryRestResource(collectionResourceRel = "order", path = "orders")
                public interface OrderRepository extends CrudRepository<Order, Long> {

                }

              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Exercise 2 First use of postman

              - 2.1 Get the Helloworld Result in Postman
              - 2.2 Create an environment "local" with a varibale host, which points to http://localhost:8080/api
              - 2.3 Create an environment "local-frontend" with a varibale host, which points to http://localhost:4200/api
              - 2.4 Import the collection "TODO add Link here".
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Exercise 3 Preparation: Install Lombok:

              ```
              java -jar lombok.jar install somepath\spring-tool-suite-4-4.3.2.RELEASE-e4.12.0-win32.win32.x86_64\sts-4.3.2.RELEASE
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ## Exercise 3 Implement the "customer" resource
              - 3.1 Customer and Address Entity
              - 3.2 CustomerRepository
              - 3.3 CustomerExcerpt
              - 3.4 Optional: make address an extra repository/table
            </script>
          </section>
          <section style=" min-height: 80%!important;">
            <div data-markdown>
              <script type="text/template">
                ### Exercise 3.1 Customer Entity
                - Fields: long id, String firstName, lastName, Address address (all except id should be required)
                - Lombok @Data,  @RequiredArgsConstructor, @NonNull
                - JPA: @Entity, @OneToOne for Address, @NonNull
                - Jackson: @JsonIgnoreProperties(ignoreUnknown = true)
              </script>
            </div>
            <details
              ><summary>Solution</summary>
              <div style="position:absolute; top:0px;">
                <pre><code class="hljs" data-trim data-noescape style=" width:800px; max-height: 600px!important"  >
                 
                  @Data
                  @Entity
                  @RequiredArgsConstructor
                  @JsonIgnoreProperties(ignoreUnknown = true)
                  public class Customer {

                    @Id
                    @GeneratedValue(strategy = GenerationType.AUTO)
                    private long id;
                    @NonNull
                    @org.springframework.lang.NonNull
                    private String firstName, lastName;
                    
                    @Version
                    private Long version;

                    @OneToOne(cascade = CascadeType.ALL, orphanRemoval = true)
                    @NonNull
                    @org.springframework.lang.NonNull
                    private Address address;

                    Customer() {
                      this.firstName = null;
                      this.lastName = null;
                      this.address = null;
                      this.version = null;
                    }

                  }
                  <button onclick="closeAll()">Close</button>
                </code></pre>
              </div>
            </details>
          </section>
          <section data-markdown>
            <script type="text/template">
              #### Exercise 3.2 Create Rest Repository

              ```java
              @RepositoryRestResource(excerptProjection = CustomerExcerpt.class)
              public interface CustomerRepository extends CrudRepository<Customer, Long> {

              }
              ```

              application properties:
              ```
              spring.data.rest.basePath=/api

              ```
            </script>
          </section>
          <section style=" min-height: 80%!important;">
            <h4>Exercise 3.3 CustomerExcerpt</h4>
            <pre><code class="hljs" data-trim data-noescape >
              @Projection(name = "detailed", types = Customer.class)
              public interface CustomerExcerpt {

                String getFirstName();

                String getLastName();

                @Value("#{target.address.toString()}")
                String getAddress();
              }
              </code></pre>
          </section>
          <section style=" min-height: 80%!important;">
            <h4>
              Exercise 3.4 Optional: make address an extra
              resource/repository/table
            </h4>
            <details
              ><summary>Solution</summary>
              <pre><code class="hljs" data-trim data-noescape >
                @RepositoryRestResource(<mark>exported = false</mark>)
                public interface AddressRepository extends CrudRepository&lt;Address, Long> {

                }
                </code></pre>
            </details>
          </section>
        </section>

        <section>
          <!-- Chapter 5 -->
          <section data-markdown>
            <script type="text/template">
              ## Externalized Configuration
              Same application code in different environments.
              <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">DOCS</a>
              <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html">common-application-properties</a>
              <ul>
                <li class="fragment">Properties files</li>
                <li class="fragment">YAML files</li>
                <li class="fragment">Environment variables</li>
                <li class="fragment">Command-line arguments</li>
              </ul>
            </script>
          </section>
          <section>
            <h2>Order of property sources</h2>
            <img data-src="screenshots/ExternalizedConfiguration.png" />
          </section>
          <section data-markdown>
            <script type="text/template">
              ### @Value
              ```
              import org.springframework.stereotype.*;
              import org.springframework.beans.factory.annotation.*;

              @Component
              public class MyBean {

                  @Value("${name}")
                  private String name;

                  // ...

              }
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### @ConfigurationProperties

              ```
              @ConfigurationProperties(prefix="my")
              public class Config {

                private List<String> servers = new ArrayList<String>();

                public List<String> getServers() {
                  return this.servers;
                }
              }
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              #### Profiles activation
              - application.properties: spring.profiles.active=dev,hsqldb
              - command line: -Dspring.profiles.active=dev,hsqldb
              #### Profile usage
              - @Profile("production") usable with @Configuration and @Component 
              - application-${profile}.properties
              - @ConditionalOnProperty(prefix = "coolsafe", name = "create-demo-data", havingValue = "true")
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Profiles in yaml files

              ```
              server:
                address: 192.168.1.100
              ---
              spring:
                profiles: development
              server:
                address: 127.0.0.1
              ---
              spring:
                profiles: production & eu-central
              server:
                address: 192.168.1.120
              ```
            </script>
          </section>
          <section data-markdown style=" font-size: 0.7em !important;">
            <script type="text/template">
              ### ConfigurationProperties usage

              ```
              @Service
              public class MyService {

                private final AcmeProperties properties;

                @Autowired
                public MyService(AcmeProperties properties) {
                    this.properties = properties;
                }

                @PostConstruct
                public void openConnection() {
                  Server server = new Server(this.properties.getRemoteAddress());
                  // ...
                }
              }
              ```
            </script>
          </section>
          <section data-markdown style=" font-size: 0.6em !important;">
            <script type="text/template">
              ### JSR 303 validation

              ```
              @ConfigurationProperties(prefix="acme")
              @Validated
              public class AcmeProperties {

                @NotNull
                private InetAddress remoteAddress;

                @Valid
                private final Security security = new Security();

                // ... getters and setters

                public static class Security {

                  @NotEmpty
                  public String username;

                  // ... getters and setters

                }

              }
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              #### Relaxed Binding
              - Binding Environment properties to @ConfigurationProperties
              - No exact match between the Environment property name and the bean property name needed.
                (for example, PORT binds to port)
              Example: property firstName
            </script>
          </section>
          <section>
            <h3>Relaxed Binding</h3>
            <img data-src="screenshots/relaxedbinding.png" />
          </section>
          <section>
            <h3>Relaxed Binding Rules</h3>
            <img data-src="screenshots/relaxedbindingrules.png" />
          </section>
          <section data-markdown>
            <script type="text/template">
              #### @ConfigurationProperties vs. @Value
              <table>
                <tr><th>Feature</th><th>@Configuration Properties</th><th>@Value</th></tr>
                <tr><td>Relaxed binding</td><td>Yes</td><td>No</td></tr>
                <tr><td>Meta-data support</td><td>Yes</td><td>No</td></tr>
                <tr><td>SpEL evaluation</td><td>No</td><td>Yes</td></tr>
              </table>
              <aside class="notes"><p>SpEL = Spring Expression Language</p><p>Meta-data: json generated from ConfigurationProperties during compiletime.</p></aside>
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
                ### Summary
                <ul>
                  <li>Merging complext types (Lists, Maps)</li>
                  <li>Do not combine profile-specific YAML files and multiple YAML documents</li>
                  <li>Configuration for components should be a POJO annotated with @ConfigurationProperties</li>
                  <li>@Value should not be used with environment variables, because no relaxed binding.</li>
                </ul>
                <aside class="notes">
                "We recommend that you don’t combine profile-specific YAML files and multiple YAML documents and stick to using only one of them."
                If you define a set of configuration keys for your own components, we recommend you group them in a POJO annotated with @ConfigurationProperties.
                You should also be aware that, since @Value does not support relaxed binding, it is not a good candidate if you need to provide the value by using environment variables.
              </aside>
            </script>
          </section>

          <section data-markdown>
            <script type="text/template">
              ## Exercise 4:
              - Create a propertie file for a new profile "local"
              - Add coolsafe.create-demo-data property
              - Create a new Component DemoData which does the data creation initialy done by SpringBootApplication class.
              - Set VM Argument -Dspring.profiles.active=local
              - Play with the application settings: 
                - override properties coolsafe.create-demo-data=false
                - Enviroment: SPRING_APPLICATION_JSON: { "coolsafe.create-demo-data": true}
            </script>
          </section>
        </section>
        <section>
          <!-- Chapter 6 -->
          <section data-markdown>
            <script type="text/template">
              ## Spring Data
              - We already used Spring Data JPA + H2
              - Lets build a File Upload using Spring Data Redis
              - It should be a new maven module
             
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              Project Stucture: 
              * de.coolsafe.api
               * DemoData
               * EmbeddedRedisConfiguration
               * FileApplicationConfig
               * FileServiceApplication
              * de.coolsafe.api.file
               * File
               * FileController
               * FileInfo
               * FileRepository
               * FileService
             
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Exercise 5: Implement File Upload as a new module
              ```
              <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-data-redis</artifactId>
              </dependency>
               
              <dependency>
                <groupId>it.ozimov</groupId>
                <artifactId>embedded-redis</artifactId>
                <version>0.7.2</version>
                <scope>test</scope>
              </dependency>
              ```
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              ### Exercise 5: Redis Config
              ```
              spring.redis.host=localhost
              spring.redis.port=6370
              ```
            </script>
          </section>
          <section style=" min-height: 80%!important;">
            <div data-markdown>
              <script type="text/template">
                ### Exercise 5: 
              </script>
            </div>
            <details
              ><summary>DemoData</summary>
              <div style="position:absolute; top:0px;">
                <pre><code class="hljs" data-trim data-noescape style=" width:800px; max-height: 600px!important"  >
                package de.coolsafe.api;


                import javax.annotation.PostConstruct;
                
                import org.springframework.beans.factory.annotation.Autowired;
                import org.springframework.boot.autoconfigure.AutoConfigureAfter;
                import org.springframework.boot.autoconfigure.AutoConfigureOrder;
                import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
                import org.springframework.context.annotation.DependsOn;
                import org.springframework.context.annotation.Profile;
                import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;
                import org.springframework.data.redis.core.RedisTemplate;
                import org.springframework.stereotype.Component;
                
                import de.coolsafe.api.file.File;
                import de.coolsafe.api.file.FileRepository;
                import lombok.extern.slf4j.Slf4j;
                
                @Component
                @Slf4j
                @ConditionalOnProperty(prefix = "coolsafe", name = "create-demo-data", havingValue = "true")
                @Profile("local")
                @DependsOn({ "embeddedRedisConfiguration" })
                public class DemoData {
                
                  @Autowired
                  FileRepository fileRepository;
                
                  public @PostConstruct void init() {
                
                    File file = new File("helloWorld", "text", "helloworld".getBytes());
                    File saved = fileRepository.save(file);
                
                    log.info("File created: {}", saved.toString());
                
                  }
                }
                                  
                  <button onclick="closeAll()">Close</button>
                </code></pre>
              </div>
            </details>
            <details
              ><summary>EmbeddedRedisConfiguration</summary>
              <div style="position:absolute; top:0px;">
                <pre><code class="hljs" data-trim data-noescape style=" width:800px; max-height: 600px!important"  >
                package de.coolsafe.api;

                import javax.annotation.PostConstruct;
                import javax.annotation.PreDestroy;
                
                import org.springframework.boot.autoconfigure.AutoConfigureOrder;
                import org.springframework.boot.autoconfigure.data.redis.RedisProperties;
                import org.springframework.context.annotation.Configuration;
                import org.springframework.context.annotation.Profile;
                
                import lombok.extern.slf4j.Slf4j;
                import redis.embedded.RedisServer;
                
                @Configuration
                @Profile("local")
                @Slf4j
                @AutoConfigureOrder(value = 0)
                public class EmbeddedRedisConfiguration {
                
                  private RedisServer redisServer;
                
                  public EmbeddedRedisConfiguration(RedisProperties redisProperties) {
                    this.redisServer = new RedisServer(redisProperties.getPort());
                  }
                
                  @PostConstruct
                  public void postConstruct() {
                    this.redisServer.start();
                    log.info("Redis Server started: {}", redisServer.ports());
                  }
                
                  @PreDestroy
                  public void preDestroy() {
                    this.redisServer.stop();
                  }
                
                }
                  <button onclick="closeAll()">Close</button>
                </code></pre>
              </div>
            </details>
            <details
              ><summary>FileApplicationConfig</summary>
              <div style="position:absolute; top:0px;">
                <pre><code class="hljs" data-trim data-noescape style=" width:800px; max-height: 600px!important"  >
                  
@Configuration
@EnableRedisRepositories
public class FileApplicationConfig {

	@Bean
	public LettuceConnectionFactory redisConnectionFactory(RedisProperties redisProperties) {
		return new LettuceConnectionFactory(
				new RedisStandaloneConfiguration(redisProperties.getHost(), redisProperties.getPort()));
	}

	@Bean
	@Resource(name = "redisTemplate")
	public RedisTemplate<?, ?> redisTemplate(LettuceConnectionFactory connectionFactory) {
		RedisTemplate<byte[], byte[]> template = new RedisTemplate<>();
		template.setConnectionFactory(connectionFactory);
		return template;
  }
}
                  <button onclick="closeAll()">Close</button>
                </code></pre>
              </div>
            </details>
          </section>
          <section data-markdown>
            <script type="text/template">
              #### Exercise 5.1: File Repository
              #### Exercise 5.2: File Service
              #### Exercise 5.3: File Controller
              #### Exercise 5.4: FileInfo Projection              
            </script>
          </section>
          <section data-markdown>
            <script type="text/template">
              #### Exercise 5.x Unit Test FileRepositoryTest
              ```
package de.coolsafe.api.file;
import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit.jupiter.SpringExtension;

import lombok.extern.slf4j.Slf4j;

@ExtendWith(SpringExtension.class)
@SpringBootTest(classes = TestRedisConfiguration.class)
public class FileRepositoryTest {

	@Autowired
	private FileRepository fileRepository;

	@Test
	public void shouldSaveFile_toRedis() {
		File file = new File("helloworld", "text", "helloworld".getBytes());
		File saved = fileRepository.save(file);
		assertNotNull(saved);
		
		File file1 = fileRepository.findById(saved.getId()).orElseThrow();
		assertNotNull(file1);
		
		assertArrayEquals("helloworld".getBytes(), file1.getData());
	}
}
              ```
              
            </script>
          </section>
        </section>
        <section data-markdown>
          <script type="text/template">
            ### Exercise 6: Implement safe + safeItem
            - Entity Safe: id, customerId, items, active, activeSince
            - resource /safes: 
            - Entity SafeItem: id, price, invoiceId, name
            - resource /safes/{id}/items: 
            
          </script>
        </section>
      </section>
        <section>
          <!-- Chapter 7 -->
          <section data-markdown>
            <script type="text/template">
              ## Spring Security
              - 
            </script>
          </section>
        </section>
          <section data-markdown>
            <script type="text/template">
              ## Spring Security
              - 
            </script>
          </section>
        </section>
          <section data-markdown>
            <script type="text/template">
              ## Excercise 7 Implement a secure endpoint
              - Autorization:
              - Authentication:
              - Put and Patch safes/{id}/items should be secure
            </script>
          </section>
        </section>
      </div>
    </div>

    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        controls: true,
        progress: true,
        center: true,
        hash: true,

        transition: "slide", // none/fade/slide/convex/concave/zoom
        dependencies: [
          {
            src: "plugin/markdown/marked.js",
            condition: function() {
              return !!document.querySelector("[data-markdown]");
            }
          },
          {
            src: "plugin/markdown/markdown.js",
            condition: function() {
              return !!document.querySelector("[data-markdown]");
            }
          },
          { src: "plugin/highlight/highlight.js", async: true },
          { src: "plugin/search/search.js", async: true },
          { src: "plugin/zoom-js/zoom.js", async: true },
          { src: "plugin/notes/notes.js", async: true }
        ]
      });
    </script>
  </body>
</html>
